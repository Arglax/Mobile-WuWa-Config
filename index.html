<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WuWa Engine.ini Generator</title>
  <style>
    :root {
      color-scheme: dark;
    }

    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: url('assets/images/Background_1.jpg') center/cover no-repeat fixed;
      background-color: rgba(0, 0, 0, 0.8);
      background-blend-mode: darken;
      color: #eee;
      margin: 0;
      padding: 6rem 2rem 4rem; /* more bottom padding for footer */
    }

    h1 {
      text-align: center;
      color: #ffcc00;
      text-shadow: 0 0 10px #000;
    }

    /* ===== Top Navigation Bar ===== */
    .top-nav {
      position: fixed;
      top: 0;
      width: 100%;
      background: rgba(15, 15, 15, 0.9);
      border-bottom: 1px solid #333;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.05);
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      padding: 0.8rem;
      z-index: 1000;
      backdrop-filter: blur(8px);
    }

    .top-nav a {
      text-decoration: none;
      color: #ffcc00;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      transition: all 0.2s ease-in-out;
    }

    .top-nav a:hover {
      color: #fff;
      transform: translateY(-2px);
    }

    /* ===== Panels ===== */
    details {
      background: rgba(20, 20, 20, 0.85);
      border: 1px solid #333;
      border-radius: 1rem;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.05);
      max-width: 800px;
      margin: 2rem auto;
      padding: 1.5rem 2rem;
      backdrop-filter: blur(8px);
    }

    summary {
      font-weight: bold;
      color: #ffcc00;
      cursor: pointer;
      font-size: 1.2em;
      margin-bottom: 1rem;
    }

    summary:hover {
      text-shadow: 0 0 6px #ffcc0066;
    }

    input[type=range] {
      width: 100%;
      accent-color: #ffcc00;
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      color: #aaa;
      margin-top: 0.2rem;
    }

    .button-row {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    button {
      background: #222;
      border: 1px solid #444;
      color: #ffcc00;
      padding: 0.6rem 1.2rem;
      border-radius: 0.4rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    button:hover {
      background: #333;
      border-color: #ffcc00;
      box-shadow: 0 0 10px #ffcc0033;
    }

    pre, textarea {
      background: #0f0f0f;
      color: #00ff66;
      padding: 1rem;
      border-radius: 0.6rem;
      overflow-x: auto;
      font-size: 0.95em;
      white-space: pre-wrap;
      word-wrap: break-word;
      box-shadow: inset 0 0 10px #000;
      width: 100%;
    }

    .utility-buttons {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      z-index: 999;
    }

    .utility-buttons button {
      background: rgba(30,30,30,0.8);
      border: 1px solid #555;
      color: #ffcc00;
      padding: 0.6rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .utility-buttons button:hover {
      background: rgba(50,50,50,0.9);
      border-color: #ffcc00;
    }

    @media (max-width: 768px) {
      body {
        padding: 6rem 1rem 3rem;
      }
      details {
        margin: 1rem;
        padding: 1rem;
      }
      pre, textarea {
        font-size: 0.85em;
      }
    }

    footer {
      text-align: center;
      font-size: 0.8em;
      color: #888;
      margin-top: 4rem;
      padding-bottom: 2rem;
    }
  </style>
</head>
<body>

  <nav class="top-nav">
    <a href="https://github.com/Arglax/Mobile-WuWa-Config/" target="_blank">üíæ GitHub Repos</a>
    <a href="https://arglax.github.io/Mobile-WuWa-Config/" target="_blank">üåê GitHub Page</a>
    <a href="https://discord.gg/renjxYBEZM" target="_blank">üí¨ Discord</a>
  </nav>

  <h1>WuWa Engine.ini Generator</h1>

  <!-- üéÆ Texture Quality -->
  <details open>
    <summary>üéÆ Far-Distance Texture Quality Scaling</summary>
    <p>Adjust texture streaming and mipmap detail levels. 0 = lowest, 11 = ultra.</p>
    <div class="slider-section">
      <label><b>Quality Scale</b></label>
      <input id="slider" type="range" min="0" max="11" value="5">
      <div class="slider-labels"><span>0</span><span>11</span></div>
    </div>
    <div class="button-row">
      <button id="dec">‚àí Decrease</button>
      <button id="reset">Reset</button>
      <button id="inc">+ Increase</button>
    </div>
    <h3>Generated Engine.ini Variables:</h3>
    <pre id="output"></pre>
  </details>

  <!-- üåë Shadows Settings -->
  <details>
    <summary>üåë Shadows Configuration</summary>

    <p>Choose between <b>Basic</b> or <b>Advanced</b> shadow tuning modes.</p>
    <div class="button-row">
      <button onclick="setShadowMode('basic')">Basic</button>
      <button onclick="setShadowMode('advanced')">Advanced</button>
    </div>

    <div id="shadowMode" style="margin-top:10px; font-weight:bold;">Current Mode: Basic</div>

    <h4>Shadow Quality Scale (0‚Äì11)</h4>
    <input type="range" min="0" max="11" value="5" id="shadowSlider" oninput="updateShadowQuality()">
    <div>Value: <span id="shadowValue">5</span></div>

    <h4>Generated Engine.ini (Shadows)</h4>
    <textarea id="shadowOutput" readonly rows="15"></textarea>

    <details style="margin-top:1rem;">
      <summary>üß† Technical Footnote ‚Äî Explanation of Shadow Settings</summary>
      <table style="width:100%; border-collapse:collapse; color:#ccc; font-size:0.9em;">
        <tr><th align="left">Setting</th><th align="left">Description</th></tr>
        <tr><td>r.ShadowQuality</td><td>Overall shadow rendering quality (0 = off, 5 = ultra).</td></tr>
        <tr><td>r.Shadow.CSM.MaxCascades</td><td>Number of cascades for directional light shadows.</td></tr>
        <tr><td>r.Shadow.MinResolution / MaxResolution</td><td>Shadow texture resolution range.</td></tr>
        <tr><td>r.Shadow.RadiusThreshold</td><td>Small-object shadow detail threshold.</td></tr>
        <tr><td>r.Shadow.FarShadow</td><td>Enables distant shadows.</td></tr>
        <tr><td>r.ContactShadows</td><td>Fine object contact shadows.</td></tr>
        <tr><td>r.CapsuleShadows</td><td>Character soft shadow approximation.</td></tr>
        <tr><td>r.DistanceFieldShadowing</td><td>Soft distance-field shadows for realism.</td></tr>
      </table>
    </details>
  </details>

  <div class="utility-buttons">
    <button onclick="collapseAll()">Collapse All</button>
    <button onclick="expandAll()">Expand All</button>
    <button onclick="window.scrollTo({top:0,behavior:'smooth'})">Back to Top</button>
  </div>

  <footer>Made by Arglax (GPT-assisted)</footer>

  <!-- ================= Scripts ================= -->
  <script>
  const slider = document.getElementById("slider");
  const output = document.getElementById("output");
  const decBtn = document.getElementById("dec");
  const incBtn = document.getElementById("inc");
  const resetBtn = document.getElementById("reset");

  function smoothScale(level, min, max, exponent = 1.3) {
    const t = Math.pow(level / 11, exponent);
    return (min + (max - min) * t);
  }

  function generateCommands(level) {
    const streamingBoost = smoothScale(level, 0, 5.5).toFixed(2);
    const groupBoost = smoothScale(level, 1, 10, 1.3).toFixed(2);
    const mipBiasArray = [6, 4, 3, 2, 1, 0, -2, -4, -6, -8, -10, -12];
    const mipLODBias = mipBiasArray[level];

    return `
r.Streaming.GroupBoost.*=${groupBoost}
r.Streaming.Boost=${streamingBoost}
r.Streaming.MinBoost=${streamingBoost}
r.Streaming.FullyLoadUsedTextures=1
r.MipMapLODBias=${mipLODBias}
r.Streaming.MipBias=-2`.trim();
  }

  function updateOutput() {
    output.textContent = generateCommands(+slider.value);
  }

  slider.addEventListener("input", updateOutput);
  decBtn.addEventListener("click", () => {
    slider.value = Math.max(0, +slider.value - 1);
    updateOutput();
  });
  incBtn.addEventListener("click", () => {
    slider.value = Math.min(11, +slider.value + 1);
    updateOutput();
  });
  resetBtn.addEventListener("click", () => {
    slider.value = 5;
    updateOutput();
  });

  updateOutput();

  function collapseAll() {
    document.querySelectorAll('details').forEach(d => d.open = false);
  }
  function expandAll() {
    document.querySelectorAll('details').forEach(d => d.open = true);
  }

  // ===== SHADOW SECTION =====
  let shadowMode = "basic";

  function setShadowMode(mode) {
    shadowMode = mode;
    document.getElementById("shadowMode").innerText = "Current Mode: " + mode.charAt(0).toUpperCase() + mode.slice(1);
    updateShadowQuality();
  }

  function updateShadowQuality() {
    const level = parseInt(document.getElementById("shadowSlider").value);
    document.getElementById("shadowValue").innerText = level;
    let output = "[SystemSettings]\n";

    if (shadowMode === "basic") {
      const quality = Math.min(Math.round((level / 11) * 5), 5);
      const minRes = 512 + Math.round((level / 11) * (2048 - 512));
      const maxRes = 1024 + Math.round((level / 11) * (4096 - 1024));
      const radius = (0.003 - (level / 11) * 0.002).toFixed(4);
      const radiusFar = (0.006 - (level / 11) * 0.003).toFixed(4);

      output += `r.ShadowQuality=${quality}\n`;
      output += `r.Shadow.MinResolution=${minRes}\n`;
      output += `r.Shadow.MaxResolution=${maxRes}\n`;
      output += `r.Shadow.RadiusThreshold=${radius}\n`;
      output += `r.Shadow.RadiusThresholdFar=${radiusFar}\n`;
      output += `r.Shadow.FarShadow=${level > 0 ? 1 : 0}\n`;
      output += `r.Shadow.CSM.MaxCascades=${Math.min(1 + Math.round(level / 3), 4)}\n`;

    } else {
      const quality = Math.min(Math.round((level / 11) * 5), 5);
      const cascades = Math.min(1 + Math.round(level / 3), 4);
      const distance = 50000 + Math.round((level / 11) * 2000000);
      const res = 1024 + Math.round((level / 11) * 3072);
      const radius = (0.003 - (level / 11) * 0.002).toFixed(4);
      const pcf = Math.min(1 + Math.round(level / 3), 3);
      const texelDensity = 2 + Math.round((level / 11) * 6);
      const fadeExp = (0.5 - (level / 11) * 0.25).toFixed(2);

      output += `
r.ShadowQuality=${quality}
r.Shadow.CSM.MaxCascades=${cascades}
r.Shadow.CSM.MaxDistance=${distance}
r.Shadow.FarShadowDistanceOverride=${distance}
r.Shadow.MinResolution=${res}
r.Shadow.MaxResolution=${res}
r.Shadow.RadiusThreshold=${radius}
r.Shadow.RadiusThresholdFar=${(radius * 2).toFixed(4)}
r.Shadow.PCFMaxSamples=${Math.round(16 + (level / 11) * 48)}
r.ContactShadows=${level > 2 ? 1 : 0}
r.CapsuleShadows=${level > 4 ? 1 : 0}
r.DistanceFieldShadowing=${level > 7 ? 1 : 0}`.trim();
    }

    document.getElementById("shadowOutput").value = output;
  }

  updateShadowQuality();
  </script>

</body>
</html>
